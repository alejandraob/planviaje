### 1. Create a new trip
POST {{baseUrl}}/viajes
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "nombre": "Viaje a Traful",
  "tipo": "amigos",
  "alcance": "nacional",
  "fecha_inicio": "2026-01-01",
  "fecha_fin": "2026-01-22",
  "descripcion": "Viaje de fin de año a la Patagonia",
  "max_miembros": 15,
  "max_subgrupos": 5,
  "max_franjas": 10
}


Respuesta
{
  "success": true,
  "message": "Trip created successfully",
  "data": {
    "viaje": {
      "fecha_creacion": "2025-10-20T13:31:46.504Z",
      "id_viaje": 4,
      "id_admin_principal": 1,
      "nombre": "Viaje a Traful",
      "tipo": "amigos",
      "alcance": "nacional",
      "fecha_inicio": "2025-12-31",
      "fecha_fin": "2026-01-21",
      "descripcion": "Viaje de fin de año a la Patagonia",
      "estado": "planificacion",
      "max_miembros": 15,
      "max_subgrupos": 5,
      "max_franjas": 10,
      "id_admin_secundario_actual": null
    }
  }
}


### 2. Get all my trips
GET {{baseUrl}}/viajes
Authorization: Bearer {{token}}

Respuesta
{
  "success": true,
  "data": {
    "viajes": [
      {
        "id_viaje": 4,
        "id_admin_principal": 1,
        "id_admin_secundario_actual": null,
        "nombre": "Viaje a Traful",
        "tipo": "amigos",
        "alcance": "nacional",
        "fecha_inicio": "2025-12-31",
        "fecha_fin": "2026-01-21",
        "descripcion": "Viaje de fin de año a la Patagonia",
        "fecha_creacion": "2025-10-20T13:31:46.504Z",
        "estado": "planificacion",
        "max_miembros": 15,
        "max_subgrupos": 5,
        "max_franjas": 10,
        "adminPrincipal": {
          "id_usuario": 1,
          "nombre": "Juan",
          "apellido": "Pérez",
          "avatar_url": null
        },
        "miembros": [
          {
            "id_miembro_viaje": 2
          }
        ],
        "mi_rol": "admin_principal",
        "total_miembros": 1
      },
      {
        "id_viaje": 1,
        "id_admin_principal": 1,
        "id_admin_secundario_actual": null,
        "nombre": "Viaje a Bariloche 2025",
        "tipo": "amigos",
        "alcance": "nacional",
        "fecha_inicio": "2025-12-14",
        "fecha_fin": "2025-12-21",
        "descripcion": "Viaje de fin de año a la Patagonia",
        "fecha_creacion": "2025-10-20T13:13:29.794Z",
        "estado": "planificacion",
        "max_miembros": 15,
        "max_subgrupos": 5,
        "max_franjas": 10,
        "adminPrincipal": {
          "id_usuario": 1,
          "nombre": "Juan",
          "apellido": "Pérez",
          "avatar_url": null
        },
        "miembros": [
          {
            "id_miembro_viaje": 1
          }
        ],
        "mi_rol": "admin_principal",
        "total_miembros": 1
      }
    ],
    "pagination": {
      "total": 2,
      "page": 1,
      "limit": 20,
      "pages": 1
    }
  }
}


### 3. Get all my trips with filters
GET {{baseUrl}}/viajes?estado=planificacion&tipo=amigos&page=1&limit=10
Authorization: Bearer {{token}}
Respuesta

{
  "success": false,
  "error": "Validation failed",
  "details": [
    {
      "field": "estado",
      "message": "\"estado\" is not allowed"
    },
    {
      "field": "tipo",
      "message": "\"tipo\" is not allowed"
    }
  ]
}

### 4. Get specific trip details
GET {{baseUrl}}/viajes/1
Authorization: Bearer {{token}}
Respuesta
{
  "success": true,
  "data": {
    "viaje": {
      "id_viaje": 1,
      "id_admin_principal": 1,
      "id_admin_secundario_actual": null,
      "nombre": "Viaje a Bariloche 2025",
      "tipo": "amigos",
      "alcance": "nacional",
      "fecha_inicio": "2025-12-14",
      "fecha_fin": "2025-12-21",
      "descripcion": "Viaje de fin de año a la Patagonia",
      "fecha_creacion": "2025-10-20T13:13:29.794Z",
      "estado": "planificacion",
      "max_miembros": 15,
      "max_subgrupos": 5,
      "max_franjas": 10,
      "adminPrincipal": {
        "id_usuario": 1,
        "nombre": "Juan",
        "apellido": "Pérez",
        "email": "test@example.com",
        "avatar_url": null
      },
      "adminSecundario": null,
      "cronograma": {
        "id_cronograma": 1,
        "fecha_inicio": "2025-12-14",
        "fecha_fin": "2025-12-21",
        "estado": "activo"
      },
      "miembros": [
        {
          "id_miembro_viaje": 1,
          "id_viaje": 1,
          "id_usuario": 1,
          "rol": "admin_principal",
          "fecha_union": "2025-10-20T13:13:29.859Z",
          "es_menor": false,
          "id_responsable_legal": null,
          "presupuesto_maximo_diario": null,
          "estado_participacion": "activo",
          "fecha_pausa_retiro": null,
          "opcion_retiro_generoso": null,
          "usuario": {
            "id_usuario": 1,
            "nombre": "Juan",
            "apellido": "Pérez",
            "email": "test@example.com",
            "avatar_url": null
          }
        }
      ]
    }
  }
}


### 5. Update trip
PUT {{baseUrl}}/viajes/1
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "nombre": "Viaje a Bariloche 2025 - Actualizado",
  "descripcion": "Viaje de fin de año a la Patagonia - Versión actualizada",
  "max_miembros": 20
}

Respuesta

{
  "success": true,
  "message": "Trip updated successfully",
  "data": {
    "viaje": {
      "id_viaje": 1,
      "id_admin_principal": 1,
      "id_admin_secundario_actual": null,
      "nombre": "Viaje a Bariloche 2025 - Actualizado",
      "tipo": "amigos",
      "alcance": "nacional",
      "fecha_inicio": "2025-12-14",
      "fecha_fin": "2025-12-21",
      "descripcion": "Viaje de fin de año a la Patagonia - Versión actualizada",
      "fecha_creacion": "2025-10-20T13:13:29.794Z",
      "estado": "planificacion",
      "max_miembros": 20,
      "max_subgrupos": 5,
      "max_franjas": 10
    }
  }
}



### 6. Get trip statistics
GET {{baseUrl}}/viajes/1/estadisticas
Authorization: Bearer {{token}}
Respuesta

{
  "success": false,
  "error": "no existe la columna alojamientos.estado",
  "stack": "Error\n    at Query.run (C:\\masCursos\\planviaje\\backend\\node_modules\\sequelize\\lib\\dialects\\postgres\\query.js:50:25)\n    at C:\\masCursos\\planviaje\\backend\\node_modules\\sequelize\\lib\\sequelize.js:315:28\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at async PostgresQueryInterface.rawSelect (C:\\masCursos\\planviaje\\backend\\node_modules\\sequelize\\lib\\dialects\\abstract\\query-interface.js:434:18)\n    at async alojamientos.aggregate (C:\\masCursos\\planviaje\\backend\\node_modules\\sequelize\\lib\\model.js:1277:19)\n    at async alojamientos.count (C:\\masCursos\\planviaje\\backend\\node_modules\\sequelize\\lib\\model.js:1306:20)\n    at async obtenerEstadisticas (C:\\masCursos\\planviaje\\backend\\src\\controllers\\viajesController.js:347:29)",
  "details": {
    "name": "SequelizeDatabaseError",
    "parent": {
      "length": 117,
      "name": "error",
      "severity": "ERROR",
      "code": "42703",
      "position": "106",
      "file": "parse_relation.c",
      "line": "3827",
      "routine": "errorMissingColumn",
      "sql": "SELECT count(*) AS \"count\" FROM \"alojamientos\" AS \"alojamientos\" WHERE \"alojamientos\".\"id_viaje\" = 1 AND \"alojamientos\".\"estado\" = 'activo';"
    },
    "original": {
      "length": 117,
      "name": "error",
      "severity": "ERROR",
      "code": "42703",
      "position": "106",
      "file": "parse_relation.c",
      "line": "3827",
      "routine": "errorMissingColumn",
      "sql": "SELECT count(*) AS \"count\" FROM \"alojamientos\" AS \"alojamientos\" WHERE \"alojamientos\".\"id_viaje\" = 1 AND \"alojamientos\".\"estado\" = 'activo';"
    },
    "sql": "SELECT count(*) AS \"count\" FROM \"alojamientos\" AS \"alojamientos\" WHERE \"alojamientos\".\"id_viaje\" = 1 AND \"alojamientos\".\"estado\" = 'activo';",
    "parameters": {},
    "statusCode": 500,
    "status": "error"
  }
}

### 7. Change trip state to "en_curso"
PUT {{baseUrl}}/viajes/1
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "estado": "en_curso"
}

Respuesta

{
  "success": true,
  "message": "Trip updated successfully",
  "data": {
    "viaje": {
      "id_viaje": 1,
      "id_admin_principal": 1,
      "id_admin_secundario_actual": null,
      "nombre": "Viaje a Bariloche 2025 - Actualizado",
      "tipo": "amigos",
      "alcance": "nacional",
      "fecha_inicio": "2025-12-14",
      "fecha_fin": "2025-12-21",
      "descripcion": "Viaje de fin de año a la Patagonia - Versión actualizada",
      "fecha_creacion": "2025-10-20T13:13:29.794Z",
      "estado": "en_curso",
      "max_miembros": 20,
      "max_subgrupos": 5,
      "max_franjas": 10
    }
  }
}


### 8. Delete trip (only principal admin, no members/expenses)
DELETE {{baseUrl}}/viajes/1
Authorization: Bearer {{token}}


Respuesta

{
  "success": true,
  "message": "Trip deleted successfully"
}


### Invalid trip duration (>365 days)
POST {{baseUrl}}/viajes
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "nombre": "Viaje muy largo",
  "tipo": "individual",
  "alcance": "internacional",
  "fecha_inicio": "2025-01-01",
  "fecha_fin": "2026-12-31",
  "descripcion": "Este viaje excede el límite de 365 días"
}
Respuesta

{
  "success": false,
  "error": "Trip duration cannot exceed 365 days",
  "stack": "Error: Trip duration cannot exceed 365 days\n    at validateTripDuration (C:\\masCursos\\planviaje\\backend\\src\\services\\viajesService.js:62:11)\n    at crearViaje (C:\\masCursos\\planviaje\\backend\\src\\controllers\\viajesController.js:39:3)\n    at C:\\masCursos\\planviaje\\backend\\src\\middleware\\errorHandler.js:117:21\n    at Layer.handle [as handle_request] (C:\\masCursos\\planviaje\\backend\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\masCursos\\planviaje\\backend\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at C:\\masCursos\\planviaje\\backend\\src\\middleware\\validation.js:34:5\n    at Layer.handle [as handle_request] (C:\\masCursos\\planviaje\\backend\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (C:\\masCursos\\planviaje\\backend\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at authenticate (C:\\masCursos\\planviaje\\backend\\src\\middleware\\auth.js:37:5)\n    at Layer.handle [as handle_request] (C:\\masCursos\\planviaje\\backend\\node_modules\\express\\lib\\router\\layer.js:95:5)",
  "details": {
    "statusCode": 400,
    "status": "fail",
    "isOperational": true
  }
}


### Missing required fields
POST {{baseUrl}}/viajes
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "nombre": "Viaje incompleto"
}
Respuesta
{
  "success": false,
  "error": "Validation failed",
  "details": [
    {
      "field": "tipo",
      "message": "\"tipo\" is required"
    },
    {
      "field": "alcance",
      "message": "\"alcance\" is required"
    },
    {
      "field": "fecha_inicio",
      "message": "\"fecha_inicio\" is required"
    },
    {
      "field": "fecha_fin",
      "message": "\"fecha_fin\" is required"
    }
  ]
}


### Invalid trip type
POST {{baseUrl}}/viajes
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "nombre": "Viaje inválido",
  "tipo": "invalido_tipo",
  "alcance": "nacional",
  "fecha_inicio": "2025-12-15",
  "fecha_fin": "2025-12-22"
}
Respuesta

{
  "success": false,
  "error": "Validation failed",
  "details": [
    {
      "field": "tipo",
      "message": "\"tipo\" must be one of [individual, amigos, familia]"
    }
  ]
}


### fecha_fin before fecha_inicio
POST {{baseUrl}}/viajes
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "nombre": "Viaje con fechas incorrectas",
  "tipo": "amigos",
  "alcance": "nacional",
  "fecha_inicio": "2025-12-22",
  "fecha_fin": "2025-12-15"
}
Respuesta

{
  "success": false,
  "error": "Validation failed",
  "details": [
    {
      "field": "fecha_fin",
      "message": "\"fecha_fin\" must be greater than \"ref:fecha_inicio\""
    }
  ]
}


### Access trip without being a member
GET {{baseUrl}}/viajes/999
Authorization: Bearer {{token}}
Respuesta

{
  "success": false,
  "error": "You do not have access to this trip",
  "stack": "Error: You do not have access to this trip\n    at checkUserAccessToTrip (C:\\masCursos\\planviaje\\backend\\src\\services\\viajesService.js:26:11)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at async obtenerViaje (C:\\masCursos\\planviaje\\backend\\src\\controllers\\viajesController.js:83:3)",
  "details": {
    "statusCode": 403,
    "status": "fail",
    "isOperational": true
  }
}

### Update trip without admin permissions
PUT {{baseUrl}}/viajes/2
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "nombre": "Trying to update without permissions"
}

